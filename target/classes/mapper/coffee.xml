<?xml version="1.0" encoding="UTF-8"?>

<!-- 
	DTD(Document Type Definition)
	- 작성한 문서가 어떤 문서인지에 대해서 정의해 놓은 것.
	- 하나의 시스템 내에서 사용할 XML 데이터의 구조를 정의하여
	  유효성을 점검시 사용하는 태그.
 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="beanDAO">

	<!-- 환희 -->
	<select id="list" resultType="coffeeBeanDTO">
		select * from coffee_beans order by beans_num
	</select>
	
	<select id="heartlist" resultType="coffeeBeanDTO">
		select * from coffee_beans order by beans_heart desc
	</select>
	
	<select id="pricedownlist" resultType="coffeeBeanDTO">
		select * from coffee_beans order by beans_price
	</select>
	
	<select id="priceuplist" resultType="coffeeBeanDTO">
		select * from coffee_beans order by beans_price desc
	</select>

	<select id="writeList" resultType="coffeeWriteDTO" parameterType="int">
		<!-- select * from coffee_write where beans_num = #{beans_num} -->
		select cw.write_num,cw.write_cont,cw.write_date, cw.write_img, cw.member_id,cw.beans_num,
		ms.coffee_star from coffee_write cw join member_star ms on cw.beans_num = ms.beans_num
		where cw.beans_num = #{beans_num}
	</select>

	<select id="check" resultType="finalMemberDTO" parameterType="finalMemberDTO">
		select fm.*, ct.*from final_member fm join coffee_test ct on fm.test_num = ct.test_num where member_id=#{member_id} and member_pwd=#{member_pwd}
	</select>
	
	<select id="Cont" parameterType="int" resultType="coffeeBeanDTO">
<!-- 	select * from coffee_beans where beans_num = #{beans_num} -->	
		with test as ( select beans_num
		                    , count(member_num) as count_heart
		              from member_star 
		             where coffee_heart = 1
		             group by beans_num 
		)select cb.*
		      , case when count_heart is null then 0 else count_heart end as count_h
		   from coffee_beans cb
		   left join test t
		     on cb.beans_num = t.beans_num where cb.beans_num = #{beans_num}
	</select>
	
	<select id="Bean_select" parameterType="map" resultType="coffeeStarDTO">
		select * from member_star where beans_num = #{beans_num} and member_num = #{member_num} 
	</select>

	<select id="heartmap1" parameterType="map" resultType="coffeeStarDTO">
		select nvl(max(beans_num),0) as beans_num , nvl(max(coffee_heart),0) as coffee_heart from member_star where member_num = #{member_num} and beans_num = #{beans_num}
	</select>

	<insert id="insertHeart1" parameterType="map">
		insert into member_star values(0, #{coffee_heart}, #{member_num}, #{beans_num})
	</insert>

	<update id="updateHeart1" parameterType="map">
		update member_star set coffee_heart = #{coffee_heart} where member_num = #{member_num} and beans_num = #{beans_num}
	</update>
	
<!--<update id="heartUp" parameterType="map">
		update coffee_beans set beans_heart = #{beans_heart} + 1 where beans_num = #{beans_num}
	</update>
	
	<update id="heartDown" parameterType="map">
		update coffee_beans set beans_heart = #{beans_heart} - 1 where beans_num = #{beans_num}
	</update>  -->
	<select id="writeCount" parameterType="int" resultType="int">
		select count(beans_num) from coffee_write where beans_num = #{beans_num}
	</select>
	
	
	<insert id="insertWrite" parameterType="coffeeWriteDTO">
		<selectKey resultType="int" keyProperty="write_num" order="BEFORE">
			select max(write_num) from coffee_write
		</selectKey>	
		insert into coffee_write values(#{write_num} + 1, #{write_cont}, sysdate, #{write_img}, #{member_id}, #{beans_num})
	</insert>

	<update id="updateStar" parameterType="coffeeStarDTO">
		update member_star set coffee_star = #{coffee_star} where member_num = #{member_num} and beans_num = #{beans_num}
	</update>

	<select id="checkWrite" parameterType="coffeeStarDTO" resultType="int">
		select count(*) from member_star where member_num = #{member_num} and beans_num = #{beans_num}
	</select>

	<delete id="deleteWrite" parameterType="int">
		delete from coffee_write where write_num = #{write_num}
	</delete>



	<!-- 홍기 -->
	<select id="MyPage" parameterType="int" resultType="finalMemberDTO">
		select * from final_member where member_num=#{member_num}
	</select>
	
	<update id="addrmodify" parameterType="finalMemberDTO">
		update final_member set member_addr =#{member_addr} where member_num=#{member_num}
	</update>
	
	<update id="addrmodify2" parameterType="finalMemberDTO">
		update final_member set member_addr2 =#{member_addr2} where member_num=#{member_num}
	</update>
	
	<update id="addrmodify3" parameterType="finalMemberDTO">
		update final_member set member_addr3 =#{member_addr3} where member_num=#{member_num}
	</update>
	
	<update id="addrmodify4" parameterType="finalMemberDTO">
		update final_member set member_addr4 =#{member_addr4} where member_num=#{member_num}
	</update>
	
	<update id="addrmodify5" parameterType="finalMemberDTO">
		update final_member set member_addr5 =#{member_addr5} where member_num=#{member_num}
	</update>
	
	<insert id="Add" parameterType="map">
		insert into member_star(coffee_heart, member_num) values(#{heart} + 1, #{no})
	</insert>


	<update id="member_Delete" parameterType="int">
		update final_member set member_use = 1 where member_num=#{member_num}
	</update>
	
	<update id="phone_modify" parameterType="finalMemberDTO" > 
		update final_member set member_phone =#{member_phone} where member_num=#{member_num}
	</update>
	
	<update id="Email_modify" parameterType="finalMemberDTO">
		update final_member set member_email=#{member_email} where member_num=#{member_num}
	</update>
	
	<update id="pwd_modify" parameterType="finalMemberDTO">
		update final_member set member_pwd=#{member_pwd} where member_num=#{member_num}
	</update>

	<select id="heart_list" resultType="finalMemberDTO" parameterType="finalMemberDTO">
		select ms.*, cb.* from member_star ms join coffee_beans cb on ms.beans_num = cb.beans_num where member_num=#{member_num}
	</select>
	

</mapper>  




  